name: Inventory Container Images

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  inventory:
    runs-on: ubuntu-latest
    steps:
      - name: Get all org repositories
        uses: actions/github-script@v7
        id: get-repos
        with:
          github-token: ${{ secrets.GH_TOKEN }}
          script: |
            const repos = await github.paginate(github.rest.repos.listForOrg, {
              org: 'opentelekomcloud-infra',
              type: 'all',
              per_page: 100
            });
            
            const images = [];
            
            for (const repo of repos) {
              console.log(`Scanning ${repo.name}...`);
              
              try {
                // Search for Dockerfiles
                const dockerfileSearch = await github.rest.search.code({
                  q: `filename:Dockerfile org:opentelekomcloud-infra repo:${repo.name}`,
                });
                
                // Search for Kubernetes/Helm YAML files
                const yamlSearch = await github.rest.search.code({
                  q: `image: extension:yaml org:opentelekomcloud-infra repo:${repo.name}`,
                });
                
                // Process results and extract image references
                // Store in images array
                
              } catch (error) {
                console.log(`Error scanning ${repo.name}: ${error.message}`);
              }
            }
            
            // Output results
            console.log(JSON.stringify(images, null, 2));
